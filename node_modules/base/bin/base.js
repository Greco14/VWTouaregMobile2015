#!/usr/bin/env node

process.title = 'base';

var tabtab = require('tabtab');

if(process.argv.slice(2)[0] === 'completion') return tabtab.complete('base', function(err, data) {
    // simply return here if there's an error or data not provided.
    // stderr not showing on completions

    if(err || !data) return;

    if(/^--\w?/.test(data.last)) return tabtab.log(['production','skip-bower','skip-npm','version'], data, '--');
    if(/^-\w?/.test(data.last)) return tabtab.log(['b', 'n', 'p', 'v'], data, '-');

    tabtab.log(['assets', 'build', 'clean', 'create', 'help','init', 'jade', 'libs', 'scripts', 'serve', 'styles', 'templates'], data);
});


var resolve = require('resolve');
var cli;

console.log("cli started at : ", process.cwd());

try {
    var projectLocalCli = resolve.sync('base', { basedir: process.cwd() });
    console.log('Found base-cli at', projectLocalCli);
    // kick off here
    cli = require(projectLocalCli);
} catch (e) {
    console.log('Unable to find a local installation of base-cli .... trying to use the global one');
    cli = require('../lib/cli');
} finally {
    cli.start();
}
