/**
 * bower-install.js
 * Created by raul on 11/19/14.
 */

var RSVP = require('rsvp');
var bower = require('bower');
var bowerConfig = require('bower-config');
var chalk = require('chalk');

module.exports = function run(options) {

    var packages = options.packages || [];
    var installOptions = options.installOptions || { save: true };

    var config = bowerConfig.read();
    //TODO make interactive bower install
    config.interactive = false;

    console.log(chalk.green('Installing browser packages via Bower.'));

    return new RSVP.Promise(function(resolve, reject) {
        bower.commands.install(packages, installOptions, config) // Packages, options, config
            .on('log', logBowerMessage)
            //.on('prompt', app.prompt.bind(app))
            .on('error', reject)
            .on('end', resolve);
    })
    .finally(function() {
        //spinner stop
    })
    .then(function() {
        console.log(chalk.green('Installed browser packages via Bower.'));
    });

    function logBowerMessage(message) {
        if (message.level === 'info' && options.verbose) {
            console.log('  ' + chalk.green(message.id) + ' ' + message.message);
        }
    }
}