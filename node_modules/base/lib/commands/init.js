/**
 * init.js
 * Created by raul on 11/19/14.
 */

var chalk = require('chalk');
var path = require('path');
var app = require('../cli');

var printDirFiles = function(dir) {
    var getFiles = require('../utils/getFiles.js');
    var files = getFiles(dir)
    for (var i in files) {
        var file = files[i].replace(dir, "");
        console.log("Writing file:", chalk.green(file));
    };
};

var init = function(callback) {

    var basedir = process.cwd();
    var scaffolds = path.join(__dirname, '..', '..', 'scaffolds', 'project');
    var spawn = require('../tasks/spawn');
    var bowerInstall = require('../tasks/bower-install');
    var npmInstall = require('../tasks/npm-install');
    var cp = require('../tasks/cp');

    console.log(chalk.bold.magenta("Creating a new base-cli project at: "), basedir);

    printDirFiles(scaffolds);

    cp(scaffolds + "/", basedir)
    .then(function () {
        if(!app.argv["skip-bower"]) {
            return bowerInstall({verbose: true});
        }
    })
    .then(function () {
        if(!app.argv["skip-npm"]) {
            return npmInstall();
        }
    })
    // capture errors on cli scope
    //.catch(function(error) {
    //    // handle errors
    //    console.log(error);
    //});
    .finally(function(){
        callback(null);
    });
};

init.usage = [
    'The ' + '`base init`'.magenta + ' command allows you create a new base-cli project in the current folder.',
    '',
    'Usage:'.cyan.bold.underline,
    '',
    ' base init'
];

module.exports = init;